<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;

        // âš ï¸ REPLACE THESE WITH YOUR ACTUAL SUPABASE VALUES âš ï¸
        const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE';
        const SUPABASE_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE';
        
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

        function WorkoutApp() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isSignUp, setIsSignUp] = useState(false);
            const [error, setError] = useState('');
            const [workouts, setWorkouts] = useState({});
            const [selectedDay, setSelectedDay] = useState(new Date().getDay());
            
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            useEffect(() => {
                supabaseClient.auth.getSession().then(({ data: { session } }) => {
                    setUser(session?.user || null);
                    if (session?.user) loadWorkouts(session.user.id);
                    setLoading(false);
                });

                const { data: { subscription } } = supabaseClient.auth.onAuthStateChange((_, session) => {
                    setUser(session?.user || null);
                    if (session?.user) loadWorkouts(session.user.id);
                });

                return () => subscription.unsubscribe();
            }, []);

            const loadWorkouts = async (userId) => {
                const { data } = await supabaseClient
                    .from('workouts')
                    .select('*')
                    .eq('user_id', userId);
                
                if (data) {
                    const workoutsByDay = {};
                    data.forEach(row => {
                        workoutsByDay[row.day_of_week] = row.exercises;
                    });
                    setWorkouts(workoutsByDay);
                }
            };

            const handleAuth = async (e) => {
                e.preventDefault();
                setError('');
                
                try {
                    if (isSignUp) {
                        const { error } = await supabaseClient.auth.signUp({ email, password });
                        if (error) throw error;
                        alert('Check your email to confirm your account!');
                    } else {
                        const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
                        if (error) throw error;
                    }
                } catch (err) {
                    setError(err.message);
                }
            };

            const handleLogout = async () => {
                await supabaseClient.auth.signOut();
                setWorkouts({});
            };

            const toggleExercise = async (dayIndex, exerciseId) => {
                const exercises = [...(workouts[dayIndex] || [])];
                const exercise = exercises.find(ex => ex.id === exerciseId);
                if (exercise) {
                    exercise.completed = !exercise.completed;
                    
                    const { data: existing } = await supabaseClient
                        .from('workouts')
                        .select('id')
                        .eq('user_id', user.id)
                        .eq('day_of_week', dayIndex)
                        .single();
                    
                    if (existing) {
                        await supabaseClient
                            .from('workouts')
                            .update({ exercises })
                            .eq('id', existing.id);
                    }
                    
                    setWorkouts({ ...workouts, [dayIndex]: exercises });
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-100">
                        <div className="text-xl">Loading...</div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-black flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md">
                            <h1 className="text-3xl font-bold text-center mb-2">ðŸ’ª Workout Tracker</h1>
                            <p className="text-gray-600 text-center mb-8">Track your progress, reach your goals</p>

                            <div className="flex gap-2 mb-6">
                                <button
                                    onClick={() => setIsSignUp(false)}
                                    className={`flex-1 py-2 rounded-lg font-medium ${!isSignUp ? 'bg-black text-white' : 'bg-gray-200'}`}
                                >
                                    Login
                                </button>
                                <button
                                    onClick={() => setIsSignUp(true)}
                                    className={`flex-1 py-2 rounded-lg font-medium ${isSignUp ? 'bg-black text-white' : 'bg-gray-200'}`}
                                >
                                    Sign Up
                                </button>
                            </div>

                            <form onSubmit={handleAuth} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium mb-1">Email</label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        required
                                        className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-black focus:outline-none"
                                        placeholder="you@example.com"
                                    />
                                </div>

                                <div>
                                    <label className="block text-sm font-medium mb-1">Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        required
                                        minLength={6}
                                        className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-black focus:outline-none"
                                        placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                    />
                                </div>

                                {error && (
                                    <div className="p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm">
                                        {error}
                                    </div>
                                )}

                                <button
                                    type="submit"
                                    className="w-full py-3 bg-black text-white rounded-lg font-medium hover:bg-gray-800"
                                >
                                    {isSignUp ? 'Sign Up' : 'Login'}
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            const todayWorkout = workouts[selectedDay] || [];
            const progress = todayWorkout.length > 0 
                ? Math.round((todayWorkout.filter(ex => ex.completed).length / todayWorkout.length) * 100)
                : 0;

            return (
                <div className="min-h-screen bg-white p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-black text-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <h1 className="text-3xl font-bold">ðŸ’ª Workout Tracker</h1>
                                <div className="flex items-center gap-4">
                                    <div className="text-right">
                                        <div className="text-sm text-gray-300">Progress</div>
                                        <div className="text-2xl font-bold text-green-400">{progress}%</div>
                                    </div>
                                    <button
                                        onClick={handleLogout}
                                        className="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm"
                                    >
                                        Logout
                                    </button>
                                </div>
                            </div>

                            <div className="flex gap-2 overflow-x-auto">
                                {days.map((day, index) => (
                                    <button
                                        key={index}
                                        onClick={() => setSelectedDay(index)}
                                        className={`px-4 py-2 rounded-lg font-medium whitespace-nowrap ${
                                            selectedDay === index
                                                ? 'bg-white text-black'
                                                : 'bg-gray-800 hover:bg-gray-700'
                                        }`}
                                    >
                                        {day}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white border-2 border-black rounded-lg p-6">
                            <div className="flex items-center justify-between mb-4">
                                <h2 className="text-xl font-bold">{days[selectedDay]}'s Workout</h2>
                                {Object.keys(workouts).length === 0 && (
                                    <button
                                        onClick={async () => {
                                            const defaultPlan = {
                                                1: [{"id":"1","name":"Standing Calf Raises","sets":3,"reps":"10-15","completed":false,"notes":"On squat machine","tutorial":""},{"id":"2","name":"Leg Extension","sets":3,"reps":"10-15","completed":false,"notes":"2 warmup sets","tutorial":"https://youtube.com/shorts/d3d2yz7V26c"},{"id":"3","name":"Hack Squat","sets":3,"reps":"10-15","completed":false,"notes":"Heavy","tutorial":"https://youtu.be/rYgNArpwE7E"},{"id":"4","name":"Leg Press","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/nDh_BlnLCGc"},{"id":"5","name":"Leg Curl","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/FMCq0hT3KRU"}],
                                                2: [{"id":"10","name":"Incline Smith Press","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/AtGwdlew4f0"},{"id":"11","name":"Cable Fly","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/z_yY1o8i6U0"},{"id":"12","name":"Preacher Curls","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/0y4tdUNPdlE"},{"id":"13","name":"Bicep Cable Curls","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtu.be/NFzTWp2qpiE"}],
                                                3: [{"id":"20","name":"Lat Pulldown","sets":5,"reps":"4-8","completed":false,"notes":"Heavy","tutorial":"https://youtube.com/shorts/hnSqbBk15tw"},{"id":"21","name":"Seated Rows","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/FTwvmczf7bE"},{"id":"22","name":"Tricep Pushdown","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtu.be/_w-HpW70nSQ"},{"id":"23","name":"Tricep Dips","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/SLk3UUV8GuI"}],
                                                4: [{"id":"30","name":"Leg Curl","sets":4,"reps":"10-15","completed":false,"notes":"1 warmup","tutorial":"https://youtube.com/shorts/FMCq0hT3KRU"},{"id":"31","name":"Wide Leg Press","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/BnacvXdaxq8"},{"id":"32","name":"RDL","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtube.com/shorts/5rIqP63yWFg"}],
                                                5: [{"id":"40","name":"Overhead Press","sets":5,"reps":"10-15","completed":false,"notes":"2 warmup","tutorial":"https://youtube.com/shorts/k6tzKisR3NY"},{"id":"41","name":"Side Lateral Raises","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtu.be/Gmi_DCnJ93c"},{"id":"42","name":"Military Press","sets":3,"reps":"10-15","completed":false,"tutorial":"https://youtu.be/2yjwXTZQDDI"}]
                                            };
                                            
                                            for (const [day, exercises] of Object.entries(defaultPlan)) {
                                                await supabaseClient.from('workouts').insert({
                                                    user_id: user.id,
                                                    day_of_week: parseInt(day),
                                                    exercises: exercises
                                                });
                                            }
                                            
                                            await supabaseClient.from('weekly_resets').insert({
                                                user_id: user.id,
                                                last_reset_date: new Date().toISOString().split('T')[0]
                                            });
                                            
                                            await loadWorkouts(user.id);
                                        }}
                                        className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium"
                                    >
                                        âœ¨ Load My Workout Plan
                                    </button>
                                )}
                            </div>
                            
                            {todayWorkout.length > 0 ? (
                                <div className="space-y-3">
                                    {todayWorkout.map((exercise) => (
                                        <div
                                            key={exercise.id}
                                            className={`p-4 rounded-lg border-2 ${
                                                exercise.completed
                                                    ? 'bg-green-50 border-green-400'
                                                    : 'border-black'
                                            }`}
                                        >
                                            <div className="flex items-center gap-3">
                                                <button
                                                    onClick={() => toggleExercise(selectedDay, exercise.id)}
                                                    className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${
                                                        exercise.completed
                                                            ? 'bg-green-500 border-green-500'
                                                            : 'border-black'
                                                    }`}
                                                >
                                                    {exercise.completed && <span className="text-white">âœ“</span>}
                                                </button>
                                                <div className="flex-1">
                                                    <h3 className={`font-semibold text-lg ${exercise.completed ? 'line-through text-gray-500' : ''}`}>
                                                        {exercise.name}
                                                    </h3>
                                                    <div className="text-sm text-gray-600">
                                                        {exercise.sets} sets Ã— {exercise.reps} reps
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="text-center py-12 text-gray-500">
                                    <p>Rest day! ðŸ˜´</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<WorkoutApp />);
    </script>
</body>
</html>
